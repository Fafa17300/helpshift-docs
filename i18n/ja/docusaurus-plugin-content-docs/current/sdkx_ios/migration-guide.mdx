---
sidebar_position: 140
title: 移行ガイド
description: "この移行ガイドでは、HelpshiftのレガシーSDKからSDK Xへの移行を行うために必要となる手順について説明します。"
---

import {
  Admonition,
  CodeBlock,
  Tabs,
  TabItem,
  LatestSdkVersion,
  Centered,
  Image,
  Intro,
  SideBySide,
  DownloadButton,
  Steps,
  Step,
} from "@site/src/components/forDocs";

import CustomIssueFieldsKeyDeprecationNotice from "@site/docs/_partials/_customIssueFieldsKeyDeprecationNotice.mdx";

# 移行ガイド

<Intro>

SDK X はハイブリッド SDK であり、ダウンタイムがなく、またアプリのアップデートを行うことなくアップデートの大半を無線を介してエンドユーザーへと送信することができるため、イノベーションを素早く展開することができます。

この移行ガイドでは、Helpshift のレガシー SDK から SDK X への移行を行うために必要となる手順について説明します。

</Intro>

## SDK X への移行を行うための手順 {#steps-to-migrate}

<Steps title="レガシーSDKからSDK Xへの移行">
  <Step
    number="1"
    title="移行のサポート状況を確認する"
    subtitle="移行ガイドを一通り確認する"
    link="/sdkx_ios/migration-guide#unsupported-features"
    newTab={true}
  />
  <Step
    number="2"
    title="SDK Xにアップデートする"
    subtitle="コードや機能を順を追って移行する"
    link="/sdkx_ios/migration-guide#update-helpshift-dependencies"
    newTab={true}
  />
  <Step number="3" title="移行のテストを行う" subtitle="機能の検証を行う" />
</Steps>

## サポートされていない機能 {#unsupported-features}

現時点で以下の API/機能を使用している場合には、SDK X への移行の延期を推奨しています -

- [ガイド付きの問題提出](/ios/support-tools#dynamic-forms)
- [埋め込みのメッセージングエクスペリエンス](/ios/support-tools#embed-messaging)
- [問題に関する記述の長さの最小値設定](/ios/sdk-configuration#issue-description-minimum-length)
- [SDK の UI 文字列のカスタマイズ](/ios/string-customization/)
- [ライトテーマとダークテーマの切り替え](/ios/design#skinning)

これらの機能はまだ開発中であり、2022 年のロードマップに追加される可能性があります。上記の API/機能に関しては、[support@helpshift.com](mailto:support@helpshift.com)までお問い合わせください。

## サポートされている SDK のバージョン {#supported-sdk-versions}

移行が成功すれば、SDK のあるバージョンから別のバージョンへと移行してもユーザーのデータとチャット履歴は保持されます。バージョン 7.x 以上のレガシー SDK から SDK X への移行がサポートされています。

<Admonition type="info" title="注意">

**6.x より前のバージョンの SDK からの移行**

6 より前のバージョンの SDK からの移行はサポートされていません。6 より前のバージョンから SDK X へと移行した場合、SDK X は正常に機能しますが、ログイン済みユーザーの情報は失われ、新しいデフォルトのユーザーが作成されます。現在のユーザーをもう一度ログインさせることは可能ですが、そのユーザーに対応するデータは移行されません。Helpshift のシステムでは、新規のユーザーとして扱われます。

</Admonition>

## Helpshift の依存関係を更新する {#update-helpshift-dependencies}

レガシー SDK と SDK X の Xcode および iOS のバージョン要件は、変更されていません。

### CocoaPods を使った自動統合

- Podfile から既存の Helpshift の依存関係を削除する
- Helpshift SDK X をプロジェクトに追加するには、[こちら](/sdkx_ios/getting-started#cocoapods)の手順に従ってください

### 手動での統合

- プロジェクトから Helpshift に関連するファイルをすべて削除します。関連するファイルには、以下のものがあります。
  - 使用する Helpshift SDK のバージョンに応じた Helpshift.xcframework または Helpshift.framework
  - HelpshiftCustomLocalizations/フォルダー
  - HelpshiftCustomThemes/フォルダー
- Helpshift SDK X をプロジェクトに追加するには、[こちら](/sdkx_ios/getting-started#manual-integration)の手順に従ってください

## コードの変更 {#code-changes}

Helpshift の依存関係を更新した後にプロジェクトのコンパイルを試みると、コンパイルエラーが発生します。これは、レガシー SDK と SDK X の間で一部の API のメソッド名とシグネチャが変更されていることが原因となっています。

#### インポート文

- `Helpshift`モジュールは、`Helpshift`ではなく`HelpshiftX`と呼ばれています。 Helpshift API を使用する予定のすべてのファイルで、`@import Helpshift;`を`@import HelpshiftX;`で置き換えてください。
- プロジェクトのヘッダーファイルで`#import <Helpshift/HelpshiftCore.h>`のようなインポート文を使用している場合には、モジュールのインポート文に置き換える必要があります。

#### Helpshift のインストール呼び出し

既存の Helpshift インストール呼び出しを削除し、以下のように置き換えてください。

```objc
@import HelpshiftX;
...
- (BOOL)application:(UIApplication *)application didFinishLaunchingWithOptions:(NSDictionary *)launchOptions
{
    ...
    NSDictionary *config = @{} // Your config
    [Helpshift installWithPlatformId:@"YOUR_PLATFORM_ID"
                              domain:@"YOUR_DOMAIN"
                              config:config];
    ...
    return YES;
}
```

詳細については、「[SDK X・はじめに](/sdkx_ios/getting-started#start-using)」ガイドをご参照ください。

#### Helpshift のインストール呼び出しの構成

SDK X のインストール呼び出しは、`HelpshiftInstallConfig`オブジェクトではなく辞書を持っています。インストール構成プロパティの辞書キーへのマッピングは、以下の通りです。

| レガシー SDK の InstallConfig プロパティ | SDK X のインストール辞書キー |
| ---------------------------------------- | ---------------------------- |
| enableLogging                            | enableLogging                |
| enableInAppNotifications                 | enableInAppNotification      |

その他の非推奨となった構成はすべて削除されており、もうサポートされていません。インストール構成の詳細については、[SDK の構成](/sdkx_ios/sdk-configuration/)ガイドをご参照ください。

#### Helpshift の Conversation API と FAQ API

API のシグネチャは変更されています。既存の API 呼び出しを、以下の新しいものに更新してください。

| レガシー SDK の API                          | SDK X API                      |
| -------------------------------------------- | ------------------------------ |
| `showConversation:withOptions:`              | `showConversationWith:config:` |
| `showFAQs:withOptions:`                      | `showFAQsWith:config:`         |
| `showFAQSection:withController:withOptions:` | `showFAQSection:with:config:`  |
| `showSingleFAQ:withController:withOptions:`  | `showSingleFAQ:with:config:`   |
| タグによる FAQ のフィルタリング              | 現在サポートされていません     |
| ガイド付きの問題提出                         | 現在サポートされていません     |
| 埋め込みのメッセージングエクスペリエンス     | 現在サポートされていません     |

SDK X の Conversation API と FAQ API の詳細については、[Helpshift API](sdkx_ios/support-tools/)ガイドをご参照ください。

#### Conversation API と FAQ API の構成

SDK X の Conversation API と FAQ API は、`HelpshiftAPIConfig`オブジェクトではなく辞書パラメーターを持っています。API 構成プロパティの辞書キーへのマッピングは、以下の通りです。

| レガシー HelpshiftAPIConfig プロパティ | SDK X API 辞書キー      | 注意                                                                                                                                       |
| -------------------------------------- | ----------------------- | ------------------------------------------------------------------------------------------------------------------------------------------ |
| presentFullScreenOniPad                | presentFullScreenOniPad | -                                                                                                                                          |
| enableFullPrivacy                      | enableFullPrivacy       | -                                                                                                                                          |
| customIssueFields                      | cifs                    | -                                                                                                                                          |
| showConversationResolutionQuestion     | -                       | 「アプリの設定」、「解決の体験」、「解決に関する質問」トグルの順に移動し、管理者ダッシュボードへと移動します                               |
| enableTypingIndicator                  | -                       | 「アプリの設定」、「サポートの体験」、「エージェントの入力インジケーターを表示する」トグルの順に移動し、管理者ダッシュボードへと移動します |
|                                        |                         |                                                                                                                                            |

その他の構成はすべて非推奨となっており、もうサポートされていません。API 構成の詳細については、[SDK の構成](/sdkx_ios/sdk-configuration/)ガイドをご参照ください。

#### Helpshift User Management API

ユーザーのログイン/ログアウトを管理するために、以下の API を置き換えます。

##### ログイン

レガシー SDK のログインコードを

```objc
HelpshiftUserBuilder *userBuilder = [[HelpshiftUserBuilder alloc] initWithIdentifier:@"unique-user-id-746501"
          andEmail:@"john.doe@app.co"];
userBuilder.name = @"John Doe";
userBuilder.authToken = @"generated-user-authentication-token";
HelpshiftUser *user = userBuilder.build;
[HelpshiftCore login:user];
```

SDK X のログインコードで置き換えます。

```objc
NSDictionary *userDetails = @{ HelpshiftUserName:@"John Doe",
                              HelpshiftUserEmail:@"john.doe@app.co",
                         HelpshiftUserIdentifier:@"unique-user-id-746501",
                          HelpshiftUserAuthToken:@"generated-user-authentication-token" };

[Helpshift loginUser:userDetails];
```

<Admonition type="info" title="注意">

SDK X への移行を行う際は、不一致を回避するためにアクティブユーザーを再度ログインさせることをお勧めします。

</Admonition>

その他のユーザー管理 API も変更されています。

| アクション         | レガシー SDK の API                   | SDK X API                                |
| ------------------ | ------------------------------------- | ---------------------------------------- |
| ログアウト         | `[HelpshiftCore logout];`             | `[Helpshift logout];`                    |
| 匿名ユーザーの消去 | `[HelpshiftCore clearAnonymousUser];` | `[Helpshift clearAnonymousUserOnLogin];` |

SDK X のユーザー管理については、[ユーザー](/sdkx_ios/users/)ガイドをご参照ください。

#### デザインとテーマ設定

SDK のデザインとテーマ設定は、SDK X ではすべて管理者ダッシュボードへと移動しています。テーマ設定 API のすべての呼び出しと、テーマ設定に関連するすべてのファイルをプロジェクトから削除してください。削除された API は、以下の通りです。-

- `setTheme:`
- `setLightTheme:darkTheme:`

テーマ設定は、管理者ダッシュボードから構成が可能です。詳細については、[SDK X のテーマ設定](https://support.helpshift.com/kb/article/configure-look-and-feel-settings/)ガイドをご参照ください。

#### 文字列のカスタマイズ

文字列のカスタマイズは、まだサポートされておりません。Helpshift ダッシュボードに移行される予定です。SDK X には反映されなくなるため、アプリで行った Helpshift SDK 関連の文字列カスタマイズはすべて削除してください。

#### Notification API

API のシグネチャは変更されています。既存の API 呼び出しを、以下に説明する新しいものに更新してください。

| アクション                       | レガシー SDK の API                                       | SDK X API                                          |
| -------------------------------- | --------------------------------------------------------- | -------------------------------------------------- |
| デバイストークンを登録する       | `[HelpshiftCore registerDeviceToken:deviceToken];`        | `[Helpshift registerDeviceToken:deviceToken];`     |
| アプリ内通知を一時停止する       | `[HelpshiftSupport pauseDisplayOfInAppNotification:YES];` | `[Helpshift pauseDisplayOfInAppNotification:YES];` |
| 未読メッセージ数をリクエストする | `[HelpshiftSupport requestUnreadMessagesCount:YES];`      | `[Helpshift requestUnreadMessageCount:YES];`       |

未読メッセージの数を受信するデリゲートメソッドも変更されました。変更前:

```objc
- (void) didReceiveUnreadMessagesCount:(NSInteger)count {
    dispatch_async(dispatch_get_main_queue(), ^{
        [yourView setTextLabel:[NSString stringWithFormat:@"%d",count];
    });
}
```

変更後:

```objc
- (void) handleHelpshiftEvent:(NSString *)eventName withData:(NSDictionary *)data {
    ...
    if([eventName isEqualToString:HelpshiftEventNameReceivedUnreadMessageCount]) {
        int count = data[HelpshiftEventDataUnreadMessageCount];
        dispatch_async(dispatch_get_main_queue(), ^{
            [yourView setTextLabel:[NSString stringWithFormat:@"%d",count];
        });
    }
}
```

##### 通知を処理する

通知のクリックを処理するには、レガシー SDK のコードを置き換えます。

```objc
- (void) userNotificationCenter:(UNUserNotificationCenter *)center
  willPresentNotification:(UNNotification *)notification
  withCompletionHandler:(void (^)(UNNotificationPresentationOptions options))completionHandler {
  if([[notification.request.content.userInfo objectForKey:@"origin"] isEqualToString:@"helpshift"]) {
    [HelpshiftCore handleNotificationWithUserInfoDictionary:notification.request.content.userInfo
                                                isAppLaunch:false
                                             withController:self.window.rootViewController];
  }
  completionHandler(...);
}
```

SDK X のコードで以下のように置き換えます。

```objc
- (void) userNotificationCenter:(UNUserNotificationCenter *)center
  willPresentNotification:(UNNotification *)notification
  withCompletionHandler:(void (^)(UNNotificationPresentationOptions options))completionHandler {
  if([[notification.request.content.userInfo objectForKey:@"origin"] isEqualToString:@"helpshift"]) {
    [Helpshift handleNotificationWithUserInfoDictionary:notification.request.content.userInfo
                                                isAppLaunch:false
                                             withController:self.window.rootViewController];
  }
  completionHandler(...);
}
```

<Admonition type="info" title="注意">

プッシュ通知を使用している場合には、不一致の可能性を回避するためのアプリのアップグレードを終えた後に SDK X でプッシュトークンの再登録を行うことをお勧めします。

</Admonition>

SDK X の Notification API の詳細については、[通知](/sdkx_ios/notifications/)ガイドをご参照ください。
SDK X のデリゲートの詳細については、[デリゲート](/sdkx_ios/delegates/)ガイドをご参照ください。

#### インターナショナリゼーション

SDK の言語を設定する API は、以下のように変更されています。

| レガシー SDK の API                  | SDK X API                       |
| ------------------------------------ | ------------------------------- |
| `[HelpshiftCore setLanguage:@"fr"];` | `[Helpshift setLanguage:"fr"];` |

<Admonition type="info" title="注意">

不一致の可能性を回避するために、SDK X でアプリをアップグレードする際に SDK の言語をもう一度設定し直すことをお勧めします。

</Admonition>

SDK X のインターナショナリゼーションの詳細やサポートされている言語のリストについては、[インターナショナリゼーション](/sdkx_ios/internationalization/)ガイドをご参照ください。

#### トラッキング

以下の API をレガシー SDK から置き換えてください。

##### メタデータ

メタデータの代わりに、CIF の使用を推奨しております。

レガシー SDK はメタデータ API を活用して会話にメタデータを付与します（[こちら](/ios/tracking#metadata)をご参照ください）。メタデータを付与するためのレガシー SDK コードを、同等の SDK X コードに置き換えます。

```objc
NSDictionary *customMetadata = @{ @"usertype": @"paid",
                                  @"level": @"7",
                                  @"score": @"12345"
 };

NSDictionary *config = @{ @"customMetadata" : customMetadata };
[Helpshift showConversationWith:self config:config];
```

##### タグ

レガシー SDK はメタデータ API を活用して会話にタグを付与します。タグを付与するために、レガシー SDK コードを置き換えます。

```objc
HelpshiftAPIConfigBuilder *builder = [[HelpshiftAPIConfigBuilder alloc] init];
builder.customMetaData = [[HelpshiftSupportMetaData alloc] initWithMetaData:@{ /* ... */ }
                                                                    andTags:@[@"feedback",@"paid user",@"v4.1"]];
HelpshiftAPIConfig *apiConfig = [builder build];
[HelpshiftSupport showFAQs:self withConfig:apiConfig]
```

同等の SDK X のコードで以下のように置き換えます。

```objc
NSArray *tags = @[@"feedback",@"paid user",@"v4.1"];
NSDictionary *config = @{@"tags":tags};
[Helpshift showConversationWith:self config:config];
```

##### カスタム問題フィールド

レガシー SDK のコードを以下のように置き換えます。

```objc
NSMutableDictionary *customIssueFieldsDict = [NSMutableDictionary dictionary];
customIssueFieldsDict[@"name"] = @[@"sl",@"John Doe"];
customIssueFieldsDict[@"address"] = @[@"ml",@"This is user's long bio"];
customIssueFieldsDict[@"level"] = @[@"n",@"42"];
customIssueFieldsDict[@"is_pro"] = @[@"b",@"true"];
customIssueFieldsDict[@"currency"] = @[@"dd", @"Dollar"];
customIssueFieldsDict[@"join_date"] = @[@"dt", @"1505927361535"];

HelpshiftAPIConfigBuilder *builder = [[HelpshiftAPIConfigBuilder alloc] init];
builder.customIssueFields = customIssueFieldsDict;
HelpshiftAPIConfig *apiConfig = [builder build];
[HelpshiftSupport showFAQs:self withConfig:apiConfig];
```

SDK X のコードで以下のように置き換えます。

```objc
NSDictionary *cifs = @{ @"name": @{ @"type":@"singleline", @"value":@"John Doe" },
                     @"address": @{ @"type":@"multiline", @"value":@"This is user's long bio" },
                       @"level": @{ @"type":@"number", @"value":@"42" },
                      @"is_pro": @{ @"type":@"boolean", @"value":@"true" },
                    @"currency": @{ @"type":@"dropdown", @"value":@"Dollar" },
                   @"join_date": @{ @"type":@"date", @"value":@"1505927361535" } };

NSDictionary *config = @{ @"cifs" : cifs };
[Helpshift showConversationWith:self config:config];
```

<CustomIssueFieldsKeyDeprecationNotice />

##### Breadcrumbs とデバッグログ

| アクション             | レガシー SDK の API                                    | SDK X API                                       |
| ---------------------- | ------------------------------------------------------ | ----------------------------------------------- |
| Breadcrumbs を残す     | `[HelpshiftSupport leaveBreadCrumb:@"Custom String"];` | `[Helpshift leaveBreadcrumb:@"Custom String"];` |
| Breadcrumbs を消去する | `[HelpshiftSupport clearBreadCrumbs];`                 | `[Helpshift clearBreadcrumbs];`                 |
| デバッグログを追加する | `[HelpshiftSupport addLog:message];`                   | `[Helpshift addLog:message];`                   |

SDK X のトラッキング API については、[トラッキング](/sdkx_ios/tracking/)ガイドをご参照ください。

#### Helpshift のデリゲート

Helpshift のデリゲートを設定するための API は、以下のように変更されています。

| レガシー SDK の API                                         | SDK X API                                            |
| ----------------------------------------------------------- | ---------------------------------------------------- |
| `[[HelpshiftSupport sharedInstance] setDelegate:delegate];` | `[[Helpshift sharedInstance] setDelegate:delegate];` |

レガシー SDK では、SDK の各イベントは個別のメソッドを持っていました。SDK X では、すべてのイベントはデリゲートの`handleHelpshiftEvent:withData:`メソッドで受信されます。イベントの一覧については、[こちらのガイド](/sdkx_ios/delegates#helpshift-delegate-events)をご参照ください。

SDK X でサポートされていないレガシー SDK メソッドの中で、対応するイベントがないものは以下の通りです。

- `userDidClickOnActionWithType:withData:`
- `displayAttachmentFileAtLocation:onViewController:`
- `didCheckIfConversationActive`

## レビューとフィードバック {#review-feedback}

エージェントによるアプリのレビューは、SDK X ではサポートされています。この機能の詳細については、[こちら](https://support.helpshift.com/hc/en/13-helpshift-technical-support/faq/782-in-app-support-what-is-the-send-review-request-function-how-do-i-use-it/)をご参照ください

以下の機能は、SDK X で非推奨となりました。

- [手動のアプリ評価リクエスト](/ios/reviews-and-feedback/#app-rating-api)
- [自動のレビューリクエスト](/ios/reviews-and-feedback/#automatic-review-request)

#### ディープリンク

ディープリンクは、レガシー SDK と同様に SDK X でもサポートされています。詳細については、[ディープリンク](/sdkx_ios/deep-linking/)をご参照ください。

## トラブルシューティング

### SDK X へのアップグレード後のコンパイルエラー

- サポートされている API および構成については、このガイドに記載されているように、すべてのレガシー SDK コードが対応する SDK X コードに置き換えられていることをご確認ください。
- サポートされていない API および構成については、このガイドに記載されているように、すべてのレガシー SDK コードが削除されていることをご確認ください。

## お問い合わせ

レガシー SDK から SDK X への移行に関して問題が発生した場合には、[support@helpshift.com](mailto:support@helpshift.com)までお問い合わせください。
